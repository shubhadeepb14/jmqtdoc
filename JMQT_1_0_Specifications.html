<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_4jcdk1dxs7ew-5{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-4{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-7{list-style-type:none}ol.lst-kix_x0ki0ka0allw-3.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-3 0}.lst-kix_4jcdk1dxs7ew-1>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-1}ol.lst-kix_4jcdk1dxs7ew-6{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-1{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-0{list-style-type:none}.lst-kix_abfc8milkhbb-0>li:before{content:"\0025cf  "}ol.lst-kix_4jcdk1dxs7ew-3{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-2{list-style-type:none}.lst-kix_abfc8milkhbb-3>li:before{content:"\0025cf  "}.lst-kix_60cl4vq7i02-4>li{counter-increment:lst-ctn-kix_60cl4vq7i02-4}ol.lst-kix_2sp7dhyadfx8-7.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-7 0}.lst-kix_abfc8milkhbb-1>li:before{content:"\0025cb  "}ol.lst-kix_4jcdk1dxs7ew-8{list-style-type:none}.lst-kix_abfc8milkhbb-2>li:before{content:"\0025a0  "}.lst-kix_2sp7dhyadfx8-6>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-6}.lst-kix_abfc8milkhbb-7>li:before{content:"\0025cb  "}.lst-kix_x0ki0ka0allw-8>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-8}.lst-kix_60cl4vq7i02-2>li{counter-increment:lst-ctn-kix_60cl4vq7i02-2}ol.lst-kix_60cl4vq7i02-5.start{counter-reset:lst-ctn-kix_60cl4vq7i02-5 0}.lst-kix_abfc8milkhbb-4>li:before{content:"\0025cb  "}.lst-kix_abfc8milkhbb-8>li:before{content:"\0025a0  "}.lst-kix_abfc8milkhbb-5>li:before{content:"\0025a0  "}.lst-kix_abfc8milkhbb-6>li:before{content:"\0025cf  "}ol.lst-kix_4jcdk1dxs7ew-1.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-1 0}.lst-kix_2sp7dhyadfx8-8>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-8}.lst-kix_x0ki0ka0allw-1>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-1}ol.lst-kix_4jcdk1dxs7ew-7.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-7 0}ol.lst-kix_2sp7dhyadfx8-2.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-2 0}ol.lst-kix_x0ki0ka0allw-8.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-8 0}ol.lst-kix_60cl4vq7i02-0.start{counter-reset:lst-ctn-kix_60cl4vq7i02-0 0}ol.lst-kix_4jcdk1dxs7ew-0.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-0 0}ol.lst-kix_2sp7dhyadfx8-1.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-1 0}ol.lst-kix_x0ki0ka0allw-2.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-2 0}.lst-kix_x0ki0ka0allw-8>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-8,lower-roman) ". "}ul.lst-kix_e8jcyp99u1ul-2{list-style-type:none}ul.lst-kix_e8jcyp99u1ul-1{list-style-type:none}ul.lst-kix_e8jcyp99u1ul-0{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-6.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-6 0}ul.lst-kix_e8jcyp99u1ul-8{list-style-type:none}ul.lst-kix_e8jcyp99u1ul-7{list-style-type:none}ul.lst-kix_e8jcyp99u1ul-6{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-8.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-8 0}ul.lst-kix_e8jcyp99u1ul-5{list-style-type:none}ul.lst-kix_e8jcyp99u1ul-4{list-style-type:none}ul.lst-kix_e8jcyp99u1ul-3{list-style-type:none}.lst-kix_ks098ttg0iz5-0>li:before{content:"\0025cf  "}ul.lst-kix_ks098ttg0iz5-0{list-style-type:none}ul.lst-kix_ks098ttg0iz5-1{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-0.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-0 0}ul.lst-kix_ks098ttg0iz5-2{list-style-type:none}.lst-kix_x0ki0ka0allw-2>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-2,lower-roman) ". "}ul.lst-kix_ks098ttg0iz5-3{list-style-type:none}ul.lst-kix_ks098ttg0iz5-4{list-style-type:none}ul.lst-kix_ks098ttg0iz5-5{list-style-type:none}ul.lst-kix_ks098ttg0iz5-6{list-style-type:none}ul.lst-kix_ks098ttg0iz5-7{list-style-type:none}ul.lst-kix_ks098ttg0iz5-8{list-style-type:none}.lst-kix_ks098ttg0iz5-2>li:before{content:"\0025a0  "}.lst-kix_x0ki0ka0allw-0>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-0,decimal) ". "}.lst-kix_ks098ttg0iz5-8>li:before{content:"\0025a0  "}.lst-kix_x0ki0ka0allw-6>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-6,decimal) ". "}.lst-kix_4jcdk1dxs7ew-8>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-8,lower-roman) ". "}.lst-kix_ks098ttg0iz5-4>li:before{content:"\0025cb  "}.lst-kix_ks098ttg0iz5-6>li:before{content:"\0025cf  "}.lst-kix_x0ki0ka0allw-4>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-4,lower-latin) ". "}.lst-kix_4jcdk1dxs7ew-6>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-6,decimal) ". "}.lst-kix_60cl4vq7i02-8>li{counter-increment:lst-ctn-kix_60cl4vq7i02-8}ol.lst-kix_x0ki0ka0allw-7.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-7 0}ol.lst-kix_60cl4vq7i02-4{list-style-type:none}ol.lst-kix_x0ki0ka0allw-4{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-0{list-style-type:none}ol.lst-kix_60cl4vq7i02-3{list-style-type:none}ol.lst-kix_x0ki0ka0allw-3{list-style-type:none}ol.lst-kix_60cl4vq7i02-6{list-style-type:none}ol.lst-kix_x0ki0ka0allw-2{list-style-type:none}ol.lst-kix_60cl4vq7i02-5{list-style-type:none}ol.lst-kix_x0ki0ka0allw-1{list-style-type:none}ol.lst-kix_60cl4vq7i02-8{list-style-type:none}ol.lst-kix_x0ki0ka0allw-8{list-style-type:none}ol.lst-kix_60cl4vq7i02-7{list-style-type:none}ol.lst-kix_x0ki0ka0allw-7{list-style-type:none}ol.lst-kix_x0ki0ka0allw-6{list-style-type:none}ol.lst-kix_x0ki0ka0allw-5{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-8{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-7{list-style-type:none}ol.lst-kix_4jcdk1dxs7ew-8.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-8 0}ol.lst-kix_2sp7dhyadfx8-6{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-5{list-style-type:none}ol.lst-kix_60cl4vq7i02-0{list-style-type:none}ol.lst-kix_x0ki0ka0allw-0{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-4{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-3{list-style-type:none}ol.lst-kix_60cl4vq7i02-2{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-2{list-style-type:none}ol.lst-kix_60cl4vq7i02-1{list-style-type:none}ol.lst-kix_2sp7dhyadfx8-1{list-style-type:none}ol.lst-kix_x0ki0ka0allw-4.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-4 0}.lst-kix_x0ki0ka0allw-5>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-5}.lst-kix_60cl4vq7i02-6>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-6,decimal) ". "}.lst-kix_4jcdk1dxs7ew-3>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-3}.lst-kix_60cl4vq7i02-4>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-4,lower-latin) ". "}.lst-kix_60cl4vq7i02-8>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-8,lower-roman) ". "}.lst-kix_x0ki0ka0allw-6>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-6}.lst-kix_60cl4vq7i02-2>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-2,lower-roman) ". "}.lst-kix_x0ki0ka0allw-0>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-0}.lst-kix_4jcdk1dxs7ew-8>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-8}.lst-kix_2sp7dhyadfx8-4>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-4}.lst-kix_4jcdk1dxs7ew-0>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-0,decimal) ". "}.lst-kix_4jcdk1dxs7ew-2>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-2}.lst-kix_4jcdk1dxs7ew-4>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-4,lower-latin) ". "}ol.lst-kix_x0ki0ka0allw-5.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-5 0}.lst-kix_4jcdk1dxs7ew-2>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-2,lower-roman) ". "}.lst-kix_60cl4vq7i02-3>li{counter-increment:lst-ctn-kix_60cl4vq7i02-3}.lst-kix_60cl4vq7i02-0>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-0,decimal) ". "}.lst-kix_2sp7dhyadfx8-8>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-8,lower-roman) ". "}.lst-kix_2sp7dhyadfx8-5>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-5,lower-roman) ". "}.lst-kix_2sp7dhyadfx8-7>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-7,lower-latin) ". "}ol.lst-kix_x0ki0ka0allw-6.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-6 0}.lst-kix_2sp7dhyadfx8-6>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-6,decimal) ". "}ol.lst-kix_2sp7dhyadfx8-4.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-4 0}ul.lst-kix_abfc8milkhbb-7{list-style-type:none}ul.lst-kix_abfc8milkhbb-6{list-style-type:none}ol.lst-kix_x0ki0ka0allw-0.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-0 0}.lst-kix_e8jcyp99u1ul-1>li:before{content:"\0025cb  "}.lst-kix_e8jcyp99u1ul-2>li:before{content:"\0025a0  "}ul.lst-kix_abfc8milkhbb-8{list-style-type:none}.lst-kix_e8jcyp99u1ul-0>li:before{content:"\0025cf  "}.lst-kix_e8jcyp99u1ul-3>li:before{content:"\0025cf  "}.lst-kix_e8jcyp99u1ul-4>li:before{content:"\0025cb  "}ul.lst-kix_abfc8milkhbb-1{list-style-type:none}ul.lst-kix_abfc8milkhbb-0{list-style-type:none}.lst-kix_60cl4vq7i02-5>li{counter-increment:lst-ctn-kix_60cl4vq7i02-5}ul.lst-kix_abfc8milkhbb-3{list-style-type:none}ul.lst-kix_abfc8milkhbb-2{list-style-type:none}ol.lst-kix_60cl4vq7i02-2.start{counter-reset:lst-ctn-kix_60cl4vq7i02-2 0}ul.lst-kix_abfc8milkhbb-5{list-style-type:none}ul.lst-kix_abfc8milkhbb-4{list-style-type:none}.lst-kix_2sp7dhyadfx8-5>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-5}.lst-kix_e8jcyp99u1ul-8>li:before{content:"\0025a0  "}.lst-kix_e8jcyp99u1ul-7>li:before{content:"\0025cb  "}.lst-kix_e8jcyp99u1ul-5>li:before{content:"\0025a0  "}.lst-kix_e8jcyp99u1ul-6>li:before{content:"\0025cf  "}.lst-kix_4jcdk1dxs7ew-0>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-0}.lst-kix_2sp7dhyadfx8-3>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-3}ol.lst-kix_60cl4vq7i02-1.start{counter-reset:lst-ctn-kix_60cl4vq7i02-1 0}ol.lst-kix_x0ki0ka0allw-1.start{counter-reset:lst-ctn-kix_x0ki0ka0allw-1 0}.lst-kix_x0ki0ka0allw-7>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-7}.lst-kix_60cl4vq7i02-7>li{counter-increment:lst-ctn-kix_60cl4vq7i02-7}ol.lst-kix_60cl4vq7i02-8.start{counter-reset:lst-ctn-kix_60cl4vq7i02-8 0}.lst-kix_60cl4vq7i02-1>li{counter-increment:lst-ctn-kix_60cl4vq7i02-1}ol.lst-kix_60cl4vq7i02-7.start{counter-reset:lst-ctn-kix_60cl4vq7i02-7 0}.lst-kix_4jcdk1dxs7ew-4>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-4}.lst-kix_2sp7dhyadfx8-3>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-3,decimal) ". "}.lst-kix_4jcdk1dxs7ew-7>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-7}.lst-kix_2sp7dhyadfx8-1>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-1,lower-latin) ". "}.lst-kix_2sp7dhyadfx8-0>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-0,decimal) ". "}.lst-kix_2sp7dhyadfx8-4>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-4,lower-latin) ". "}.lst-kix_2sp7dhyadfx8-2>li:before{content:"" counter(lst-ctn-kix_2sp7dhyadfx8-2,lower-roman) ". "}ol.lst-kix_60cl4vq7i02-6.start{counter-reset:lst-ctn-kix_60cl4vq7i02-6 0}.lst-kix_2sp7dhyadfx8-0>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-0}.lst-kix_4jcdk1dxs7ew-6>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-6}.lst-kix_ks098ttg0iz5-3>li:before{content:"\0025cf  "}.lst-kix_x0ki0ka0allw-1>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-1,lower-latin) ". "}.lst-kix_ks098ttg0iz5-1>li:before{content:"\0025cb  "}.lst-kix_x0ki0ka0allw-7>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-7,lower-latin) ". "}.lst-kix_ks098ttg0iz5-7>li:before{content:"\0025cb  "}.lst-kix_x0ki0ka0allw-4>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-4}ol.lst-kix_60cl4vq7i02-3.start{counter-reset:lst-ctn-kix_60cl4vq7i02-3 0}.lst-kix_x0ki0ka0allw-3>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-3}.lst-kix_x0ki0ka0allw-3>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-3,decimal) ". "}.lst-kix_4jcdk1dxs7ew-5>li{counter-increment:lst-ctn-kix_4jcdk1dxs7ew-5}.lst-kix_4jcdk1dxs7ew-7>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-7,lower-latin) ". "}.lst-kix_x0ki0ka0allw-5>li:before{content:"" counter(lst-ctn-kix_x0ki0ka0allw-5,lower-roman) ". "}.lst-kix_ks098ttg0iz5-5>li:before{content:"\0025a0  "}ol.lst-kix_4jcdk1dxs7ew-2.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-2 0}ol.lst-kix_2sp7dhyadfx8-6.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-6 0}.lst-kix_x0ki0ka0allw-2>li{counter-increment:lst-ctn-kix_x0ki0ka0allw-2}ol.lst-kix_4jcdk1dxs7ew-5.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-5 0}.lst-kix_2sp7dhyadfx8-2>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-2}ol.lst-kix_2sp7dhyadfx8-3.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-3 0}.lst-kix_60cl4vq7i02-5>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-5,lower-roman) ". "}.lst-kix_60cl4vq7i02-7>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-7,lower-latin) ". "}.lst-kix_60cl4vq7i02-1>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-1,lower-latin) ". "}.lst-kix_60cl4vq7i02-3>li:before{content:"" counter(lst-ctn-kix_60cl4vq7i02-3,decimal) ". "}ol.lst-kix_4jcdk1dxs7ew-4.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-4 0}ol.lst-kix_2sp7dhyadfx8-5.start{counter-reset:lst-ctn-kix_2sp7dhyadfx8-5 0}.lst-kix_4jcdk1dxs7ew-3>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-3,decimal) ". "}.lst-kix_4jcdk1dxs7ew-5>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-5,lower-roman) ". "}.lst-kix_4jcdk1dxs7ew-1>li:before{content:"" counter(lst-ctn-kix_4jcdk1dxs7ew-1,lower-latin) ". "}.lst-kix_2sp7dhyadfx8-7>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-7}.lst-kix_60cl4vq7i02-0>li{counter-increment:lst-ctn-kix_60cl4vq7i02-0}.lst-kix_60cl4vq7i02-6>li{counter-increment:lst-ctn-kix_60cl4vq7i02-6}ol.lst-kix_4jcdk1dxs7ew-3.start{counter-reset:lst-ctn-kix_4jcdk1dxs7ew-3 0}.lst-kix_2sp7dhyadfx8-1>li{counter-increment:lst-ctn-kix_2sp7dhyadfx8-1}ol.lst-kix_60cl4vq7i02-4.start{counter-reset:lst-ctn-kix_60cl4vq7i02-4 0}ol{margin:0;padding:0}table td,table th{padding:0}.c37{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:330pt;border-top-color:#000000;border-bottom-style:solid}.c39{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:123pt;border-top-color:#000000;border-bottom-style:solid}.c38{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:93pt;border-top-color:#000000;border-bottom-style:solid}.c8{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:65.2pt;border-top-color:#000000;border-bottom-style:solid}.c3{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:129pt;border-top-color:#000000;border-bottom-style:solid}.c35{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:144.8pt;border-top-color:#000000;border-bottom-style:solid}.c43{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:177pt;border-top-color:#000000;border-bottom-style:solid}.c4{background-color:#ffffff;color:#134f5c;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Verdana";font-style:normal}.c1{background-color:#ffffff;color:#454545;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Verdana";font-style:normal}.c25{background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Courier New";font-style:normal}.c18{margin-left:1pt;padding-top:1pt;padding-bottom:1pt;line-height:1.0;orphans:2;widows:2;text-align:left;margin-right:1pt}.c20{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:justify}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:justify;height:10pt}.c31{padding-top:10pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:justify}.c42{padding-top:10pt;padding-bottom:4pt;line-height:1.0;orphans:2;widows:2;text-align:justify}.c40{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c15{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:justify}.c13{padding-top:18pt;padding-bottom:6pt;line-height:1.0;page-break-after:avoid;text-align:justify}.c27{color:#434343;text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c23{color:#454545;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c46{color:#b45f06;text-decoration:none;vertical-align:baseline;font-size:12pt;font-style:normal}.c10{color:#454545;text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c34{text-decoration:none;vertical-align:baseline;font-size:13pt;font-style:normal}.c17{border-spacing:0;border-collapse:collapse;margin-right:auto}.c44{text-decoration:none;vertical-align:baseline;font-size:15pt;font-style:normal}.c16{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:justify}.c11{color:#454545;vertical-align:baseline;font-size:10pt;font-style:normal}.c41{text-decoration:none;vertical-align:baseline;font-size:16pt;font-style:normal}.c29{text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c24{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c28{color:#454545;text-decoration:none;vertical-align:baseline;font-style:normal}.c32{background-color:#ffffff;max-width:516.1pt;padding:39.6pt 39.6pt 39.6pt 39.6pt}.c14{background-color:#ffffff;font-weight:400;font-family:"Arial"}.c0{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;text-decoration:underline}.c6{background-color:#ffffff;font-family:"Verdana";font-weight:400}.c7{color:#3d85c6;font-weight:700}.c26{padding:0;margin:0}.c30{font-weight:400;font-family:"Verdana"}.c48{background-color:#ffffff;font-family:"Verdana"}.c22{margin-left:36pt;padding-left:0pt}.c12{color:inherit;text-decoration:inherit}.c5{height:0pt}.c50{font-size:11pt}.c45{font-size:9pt}.c49{color:#0b5394}.c19{font-size:10.5pt}.c21{color:#1155cc}.c9{color:#3d85c6}.c47{height:13pt}.c36{color:#134f5c}.c33{font-weight:700}.title{background-color:#ffffff;padding-top:0pt;color:#454545;font-size:26pt;padding-bottom:3pt;font-family:"Verdana";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:justify}.subtitle{background-color:#ffffff;padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:justify}li{background-color:#ffffff;color:#454545;font-size:10pt;font-family:"Verdana"}p{background-color:#ffffff;margin:0;color:#454545;font-size:10pt;font-family:"Verdana"}h1{background-color:#ffffff;padding-top:18pt;color:#3d85c6;font-size:13pt;padding-bottom:6pt;font-family:"Verdana";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h2{background-color:#ffffff;padding-top:18pt;color:#134f5c;font-size:12pt;padding-bottom:6pt;font-family:"Verdana";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h3{background-color:#ffffff;padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Verdana";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h4{background-color:#ffffff;padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Verdana";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h5{background-color:#ffffff;padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Verdana";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h6{background-color:#ffffff;padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Verdana";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:justify}</style></head><body class="c32"><p class="c40"><span class="c33 c50">JMQT Version 1.0 Specifications</span></p><h1 class="c13" id="h.zge6k9dm68y5"><span class="c34 c6 c9">Table of Contents</span></h1><p class="c2"><span class="c10 c6"></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.8vxy8rdz0pd">1. What is JMQT (JSON Message Queueing and Transfer) ?</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.8vxy8rdz0pd">1</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.5mjlobpldpnj">2. Purpose of this document</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.5mjlobpldpnj">2</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.3u3w8das7bi7">3. Terminology</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.3u3w8das7bi7">2</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.m4suh13zoswa">4. Version History</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.m4suh13zoswa">3</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.6b5x5anekv3w">5. Protocol Overview</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.6b5x5anekv3w">3</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.9e9ukwewchf4">6. Packet Types</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.9e9ukwewchf4">3</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.r7zipi9isf42">7. Packet Structure</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.r7zipi9isf42">4</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.pol39bmpwwwz">a. Auth Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.pol39bmpwwwz">4</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.c88jlzfqy03">b. Auth Acknowledgement</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.c88jlzfqy03">4</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.a7wljpa6c5pk">c. Connect Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.a7wljpa6c5pk">5</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.j82ueh689dml">d. Connect Acknowledgement</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.j82ueh689dml">5</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.hju3ogj54d75">e. Heartbeat Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.hju3ogj54d75">6</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.77cdkz6m7ixe">f. Heartbeat Acknowledgement</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.77cdkz6m7ixe">6</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.s2jdhmr3bkev">g. Subscribe Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.s2jdhmr3bkev">7</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.olfp3xv4uhrl">h. Subscribe Acknowledgement</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.olfp3xv4uhrl">7</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.jc7c4nsh5sap">i. Unsubscribe Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.jc7c4nsh5sap">8</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.dzw4q9z9s7r9">j. Unsubscribe Acknowledgement</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.dzw4q9z9s7r9">8</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.ma2f1jaepdzx">k. Publish Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.ma2f1jaepdzx">9</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.qw02dn3mow1r">l. Publish Acknowledgment</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.qw02dn3mow1r">9</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.buezqc6h7nbg">m. Push Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.buezqc6h7nbg">10</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.oxdbvk88t65o">n. Push Acknowledgment</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.oxdbvk88t65o">11</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.71q18h5vmqkr">o. Disconnection Packet</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.71q18h5vmqkr">11</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.ygslinu4oodu">8. Status Codes</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.ygslinu4oodu">11</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.nyr83t205lkz">9. Operational Behaviour</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.nyr83t205lkz">12</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.ug756rndpk1s">a. Quality of Service</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.ug756rndpk1s">12</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.ja7lxeorgb6l">b. Retained Packets</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.ja7lxeorgb6l">13</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.8crgxdt3uq6v">c. Persistent Subscription</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.8crgxdt3uq6v">13</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.7lqzk4nh64pz">d. P2P and Control Packets</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.7lqzk4nh64pz">14</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.6bpomxmd8hqn">e. Server side Sub, Unsub and Push</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.6bpomxmd8hqn">15</a></span></p><p class="c20"><span class="c9"><a class="c12" href="#h.mab1zj286xne">f. Disconnection behaviour</a></span><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9"><a class="c12" href="#h.mab1zj286xne">15</a></span></p><p class="c31"><span class="c7"><a class="c12" href="#h.kifcx4unbfeg">10. Authentication and security</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.kifcx4unbfeg">15</a></span></p><p class="c42"><span class="c7"><a class="c12" href="#h.ste6oqketqd2">11. Default TCP Ports</a></span><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c7"><a class="c12" href="#h.twnod71ves3">16</a></span></p><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><hr style="page-break-before:always;display:none;"><h1 class="c13 c47" id="h.8vxy8rdz0pd"><span class="c34 c6 c9"></span></h1><h1 class="c13" id="h.wtwwybwchtq4"><span>1. What is JMQT (JSON Message Queueing and Transfer) ?</span></h1><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>JMQT is a </span><span class="c0">publish-subscribe based IoT and messaging protocol</span><span>, which works on top of TCP/IP. It is a </span><span class="c0">text based protocol</span><span>, where the packets are build in </span><span class="c0">JSON</span><span class="c10 c6">&nbsp;(JavaScript Object Notation) format and converted into text.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>JMQT has been primarily developed for IoT and messaging applications, where multiple clients are connected to a server in order to exchange messages between them. JMQT also supports P2P (Point to Point) messaging in addition to publish-subscribe operations. </span><span class="c0">JMQT</span><span>&nbsp;protocol is </span><span class="c0">open &amp; free</span><span>, and anyone can </span><span class="c0">use</span><span>&nbsp;this protocol </span><span class="c0">without any license agreement</span><span class="c10 c6">.</span></p><h1 class="c13" id="h.5mjlobpldpnj"><span>2</span><span>. Purpose of this document</span></h1><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>This document covers the specifications of JMQT protocol version 1.0. The primary purpose of this document is to define the principles of the JMQT protocol 1.0 along with sample packets and operational behaviour. </span></p><h1 class="c13" id="h.3u3w8das7bi7"><span>3</span><span class="c30">. </span><span class="c6 c9 c34">Terminology</span></h1><p class="c2"><span class="c10 c14"></span></p><p class="c15"><span>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this specification are to be interpreted as described in IETF RFC 2119 </span><span class="c0 c21"><a class="c12" href="https://www.google.com/url?q=https://www.ietf.org/rfc/rfc2119.txt&amp;sa=D&amp;ust=1544704533805000">[RFC2119]</a></span><span class="c10 c6">.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Socket:</span></p><p class="c15"><span>Standard socket connection over TCP/IP as defined in IETF RFC 147 [</span><span class="c0 c21"><a class="c12" href="https://www.google.com/url?q=https://tools.ietf.org/html/rfc147&amp;sa=D&amp;ust=1544704533806000">RCF147</a></span><span class="c10 c6">].</span></p><p class="c15"><span class="c11 c0 c6">WebSocket:</span></p><p class="c15"><span>Standard WebSocket connection over TCP/IP as defined in IETF RFC 6455 [</span><span class="c0 c21"><a class="c12" href="https://www.google.com/url?q=https://tools.ietf.org/html/rfc6455&amp;sa=D&amp;ust=1544704533807000">RFC6455</a></span><span class="c10 c6">].</span></p><p class="c15"><span class="c11 c0 c6">JSON:</span></p><p class="c15"><span>Javascript Object Notation as defined in IETF RFC 7159 [</span><span class="c0 c21"><a class="c12" href="https://www.google.com/url?q=https://tools.ietf.org/html/rfc7159&amp;sa=D&amp;ust=1544704533807000">RFC7159</a></span><span class="c10 c6">]. </span></p><p class="c15"><span class="c11 c0 c6">Client:</span></p><p class="c15"><span class="c10 c6">A program or device that uses JMQT. A Client always establishes the Network Connection to the Server. It can</span></p><ul class="c26 lst-kix_abfc8milkhbb-0 start"><li class="c15 c22"><span class="c10 c6">Publish Packets that other Clients might be interested in.</span></li><li class="c15 c22"><span class="c10 c6">Subscribe to request Packets that it is interested in receiving.</span></li><li class="c15 c22"><span class="c10 c6">Unsubscribe to remove a request for Packets.</span></li><li class="c15 c22"><span class="c10 c6">Disconnect from the Server.</span></li></ul><p class="c15"><span class="c11 c0 c6">Server:</span></p><p class="c15"><span class="c10 c6">A program or device that acts as an intermediary between Clients which publish packets and Clients which have made Subscriptions. A Server</span></p><ul class="c26 lst-kix_e8jcyp99u1ul-0 start"><li class="c15 c22"><span class="c10 c6">Accepts Network Connections from Clients.</span></li><li class="c15 c22"><span class="c10 c6">Accepts Packets published by Clients.</span></li><li class="c15 c22"><span class="c10 c6">Processes Subscribe and Unsubscribe requests from Clients.</span></li><li class="c15 c22"><span class="c10 c6">Forwards Packets that match Client Subscriptions.</span></li></ul><p class="c15"><span class="c11 c0 c6">Subscription:</span></p><p class="c15"><span>A Subscription comprises a Channel Name and a maximum QOS (see </span><span class="c0 c21"><a class="c12" href="#h.ug756rndpk1s">section 9.a</a></span><span>&nbsp;for QOS). A Subscription can associated with a single Session or can be persistent depending on the Persistence Flag (see</span><span class="c0 c21"><a class="c12" href="#h.8crgxdt3uq6v">&nbsp;section 9.c</a></span><span class="c10 c6">). A Session can contain more than one Subscription. Each Subscription within a session has a different Channel Name.</span></p><p class="c15"><span class="c11 c0 c6">Channel Name:</span></p><p class="c15"><span class="c10 c6">The label attached to a packet which is matched against the Subscriptions known to the Server. The Server sends a copy of the published packet to each Client that has a matching Subscription.</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Session:</span></p><p class="c15"><span class="c10 c6">A stateful interaction between a Client and a Server. Some Sessions last only as long as the Network Connection, others can span multiple consecutive Network Connections between a Client and a Server.</span></p><p class="c15"><span class="c11 c0 c6">JMQT Packet:</span></p><p class="c15"><span class="c10 c6">A packet of information containing JSON data that is sent across the Network Connection. The JMQT specification defines fifteen different types of Packet, one of which (the Publish packet) is used to convey messages.</span></p><h1 class="c13" id="h.m4suh13zoswa"><span>4</span><span class="c34 c6 c9">. Version History</span></h1><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.4f8bad481255644bba462e0e0c299e80d4969cf3"></a><a id="t.0"></a><table class="c17"><tbody><tr class="c5"><td class="c38" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Date</span></p></td><td class="c43" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Description</span></p></td><td class="c39" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Prepared By</span></p></td><td class="c39" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Remarks</span></p></td></tr><tr class="c5"><td class="c38" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">3 Dec 2018</span></p></td><td class="c43" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Initial Document Preparation</span></p></td><td class="c39" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Shubhadeep Banerjee</span></p></td><td class="c39" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Defining JMQT 1.0</span></p></td></tr></tbody></table><p class="c2"><span class="c10 c6"></span></p><h1 class="c13" id="h.6b5x5anekv3w"><span class="c30">5. Protocol Overview</span></h1><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c30">JMQT consists of clients communicating to a server, primarily using </span><span class="c0 c30">Socket (or Web Socket)</span><span class="c10 c6">&nbsp;connection. A client may be either a publisher or a subscriber. </span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c30">JMQT is built on the concept of </span><span class="c0 c30">Channels</span><span class="c30">, </span><span>which are used by</span><span class="c30">&nbsp;the publishers to </span><span class="c0 c30">send</span><span class="c30">&nbsp;messages, and are used by the subscribers to </span><span class="c0">receive</span><span class="c30">&nbsp;messages. When a publisher has a new message to distribute, it sends a </span><span class="c0 c30">&lsquo;publish&rsquo;</span><span class="c30">&nbsp;packet to the server with the channel name and the message. The server then distributes the message among the subscribers of that particular channel &nbsp;by sending the </span><span class="c0 c30">&lsquo;push&rsquo;</span><span class="c10 c6">&nbsp;packets.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>If the server receives a publish packet to a channel which has no current subscribers, it discards the message unless the publisher indicates that the message is to be retained (see </span><span class="c0 c21"><a class="c12" href="#h.ja7lxeorgb6l">section 9.b</a></span><span>&nbsp;for retained packets). When a new subscriber subscribes to that channel (by sending a </span><span class="c0">&lsquo;subscribe&rsquo;</span><span>&nbsp;packet), the </span><span class="c0">retained</span><span>&nbsp;message for that channel is sent to the subscriber allowing the new subscriber to receive the most current message of that channel rather than waiting for the next update from a publisher.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">There are two special </span><span>types of channels</span><span class="c6">&nbsp;available in JMQT, </span><span class="c0">C</span><span class="c0 c6">ontrol channels</span><span class="c6">&nbsp;and </span><span class="c0 c6">P2P channels</span><span class="c6">. For details on </span><span>P2P</span><span class="c6">&nbsp;and control packets, see </span><span class="c0 c6 c21"><a class="c12" href="#h.7lqzk4nh64pz">section </a></span><span class="c0 c21"><a class="c12" href="#h.7lqzk4nh64pz">9.d</a></span><span class="c6">.</span></p><h1 class="c13" id="h.9e9ukwewchf4"><span class="c30">6</span><span class="c34 c6 c9">. Packet Types</span></h1><p class="c2"><span class="c28 c19 c33 c48"></span></p><p class="c15"><span class="c10 c6">JMQT protocol has the following packet types :</span></p><ol class="c26 lst-kix_2sp7dhyadfx8-0 start" start="1"><li class="c15 c22"><span class="c10 c6">Auth (sent by the client to receive authentication token and client id)</span></li><li class="c15 c22"><span class="c10 c6">Auth Acknowledgment (authentication status, token and client id sent back by the server)</span></li><li class="c15 c22"><span class="c6">Connect (sent by the client to</span><span>&nbsp;establish a session</span><span class="c10 c6">, contains authentication token and client id)</span></li><li class="c15 c22"><span class="c10 c6">Connect Acknowledgment (connection status sent back by the server)</span></li><li class="c15 c22"><span class="c10 c6">Heartbeat (sent by the client in regular intervals to inform the server about its availability)</span></li><li class="c15 c22"><span class="c10 c6">Heartbeat Acknowledgment (sent by the server to indicate that it is receiving the heartbeats)</span></li><li class="c15 c22"><span class="c10 c6">Subscribe (sent by the client to subscribe to a channel)</span></li><li class="c15 c22"><span>Subscribe</span><span class="c10 c6">&nbsp;Acknowledgment (subscription status sent back by the server)</span></li><li class="c15 c22"><span class="c10 c6">Unsubscribe (sent by the client to unsubscribe to a channel)</span></li><li class="c15 c22"><span>Unsubscribe</span><span class="c10 c6">&nbsp;Acknowledgment (unsubscription status sent back by the server)</span></li><li class="c15 c22"><span class="c10 c6">Publish (sent by the client to publish a message to a channel)</span></li><li class="c15 c22"><span class="c10 c6">Publish Acknowledgment (publish status sent back by the server, this message is option depending on the QOS)</span></li><li class="c15 c22"><span class="c10 c6">Push (sent by the server to distribute a published message)</span></li><li class="c15 c22"><span class="c6">Push Acknowledgment (sent back by the client to indicate that it has received the </span><span>push packet</span><span class="c10 c6">, this message is optional depending on the QOS)</span></li><li class="c15 c22"><span class="c10 c6">Disconnect (sent by the client to indicate that the client is willingly disconnecting the server)</span></li></ol><h1 class="c13" id="h.r7zipi9isf42"><span>7</span><span>. Packet Structure</span></h1><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c6">JMQT packets are JSON packets with the </span><span class="c0 c6">root element</span><span class="c6">&nbsp;of the packet indicating the </span><span class="c0 c6">packet type</span><span class="c10 c6">, i.e. the packets look like the following :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{ &lt;packet type&gt; : {&lt;packet data in JSON&gt;}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>Any kind of data transferred in a packet can be a JSON object or a plain string, depending on the business logic of the system. Any </span><span class="c0">acknowledgement</span><span>&nbsp;packet generated from the server contains a </span><span class="c0">status code</span><span>&nbsp;(see </span><span class="c0 c21"><a class="c12" href="#h.ygslinu4oodu">section 8</a></span><span>&nbsp;for the details on the JMQT status codes) which indicates the status of the action requested by the client.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">Below is the detailed description of each of the packet types mentioned in </span><span class="c0 c6 c21"><a class="c12" href="#h.9e9ukwewchf4">section </a></span><span class="c0 c21"><a class="c12" href="#h.9e9ukwewchf4">6</a></span><span class="c6">&nbsp;with </span><span>example</span><span class="c10 c6">&nbsp;packets indicating the real-life scenarios :</span></p><h2 class="c13" id="h.pol39bmpwwwz"><span>a. Auth Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c6">Auth packets are </span><span class="c0 c6">sent by the client</span><span class="c6">&nbsp;to the server to </span><span class="c0 c6">authenticate</span><span class="c6">&nbsp;itself and get an authentication token for future communication. Auth packets contain the </span><span class="c0 c6">authentication information</span><span class="c6">&nbsp;as a JSON </span><span>object or a string.</span><span class="c10 c6">&nbsp;Auth packets can be used for login or registration in web based applications, registration of the client using IMEI or mac no., and so on.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;auth</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.be19527ee88926449274d9eaad0139063e23084e"></a><a id="t.1"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c33">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Auth Data</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">dt</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">JSON / String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">Yes</span></p></td></tr></tbody></table><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c10 c6">1. Sample login :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;auth&quot;:{&quot;dt&quot;:{&quot;login&quot;:{&quot;email&quot;:&quot;email@example.com&quot;,&quot;password&quot;:&quot;my password&quot;}}}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. Sample device registration using IMEI:</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;auth&quot;:{&quot;dt&quot;:{&quot;IMEI&quot;:&quot;xxxxxxxxxxxxxxx&quot;}}}</span></p><h2 class="c13" id="h.c88jlzfqy03"><span>b. Auth Acknowledgement</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0 c6">Server </span><span class="c0">MUST</span><span class="c0 c6">&nbsp;validate</span><span class="c6">&nbsp;an </span><span class="c0 c6">auth</span><span class="c6">&nbsp;packet and </span><span class="c0 c6">acknowledge</span><span class="c6">&nbsp;to the</span><span class="c6">&nbsp;</span><span>client</span><span class="c6">&nbsp;</span><span>with</span><span class="c6">&nbsp;an </span><span class="c0 c6">Auth Ack</span><span class="c6">&nbsp;packet. This auth ack packet contains a </span><span class="c0 c6">status code</span><span class="c6">&nbsp;</span><span>which denotes</span><span class="c6">&nbsp;the status of the auth request (for details on status code see</span><span class="c0 c6 c21"><a class="c12" href="#h.ygslinu4oodu">&nbsp;section </a></span><span class="c0 c21"><a class="c12" href="#h.ygslinu4oodu">8</a></span><span class="c6">), an </span><span class="c0 c6">optional authentication token &amp; client id</span><span class="c6">&nbsp;(if the authentication is successful), and an </span><span class="c0 c6">optional message</span><span class="c10 c6">&nbsp;(mentioning the reason in case the authentication is unsuccessful). If the authentication is successful, the client will use the client id and auth token to send the connect packet to the server.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;authAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.101f11b32eb95fb4b85a413cc46bd0b2c1849588"></a><a id="t.2"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c33">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Status Code</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">st</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Integer</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Auth Token</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">at</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if Status Code is 1 (OK)</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Client ID</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cl</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if Status Code is 1 (OK)</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Message</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">mg</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if Status Code is not 1 (OK)</span></p></td></tr></tbody></table><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c10 c6">1. Status code 1 (OK) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;authAck&quot;:{&quot;st&quot;:1,&quot;at&quot;:&quot;my token&quot;,&quot;cl&quot;:&quot;client 1&quot;}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. Status code 0 (FAILED) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;authAck&quot;:{&quot;st&quot;:0,&quot;mg&quot;:&quot;Email and/or password not valid&quot;}}</span></p><h2 class="c13" id="h.a7wljpa6c5pk"><span class="c4">c. Connect Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>Connect packets are </span><span class="c0">sent by the client</span><span>&nbsp;to the server to </span><span class="c0">establish</span><span>&nbsp;a JMQT </span><span class="c0">session</span><span>. </span><span class="c0">Only</span><span>&nbsp;the </span><span class="c0">connected clients with established session</span><span>&nbsp;can </span><span class="c0">perform</span><span>&nbsp;the JMQT operations like </span><span class="c0">publish</span><span>, </span><span class="c0">subscribe</span><span>, </span><span class="c0">unsubscribe</span><span>&nbsp;and </span><span class="c0">receive push packets</span><span>&nbsp;from the server. A connect packet contains the </span><span class="c0">client id and auth token</span><span>&nbsp;which the client may receive from the server in the auth acknowledgement or can be preset into the client program. A connect packet is followed by a connect ack generated by the server accepting or declining the session request.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;conn</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.d7838889c12c8d802f8a4aca5424d22c38d3b3ca"></a><a id="t.3"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c33">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Auth Token</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">at</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Client ID</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cl</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr></tbody></table><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;conn&quot;:{&quot;at&quot;:&quot;my token&quot;,&quot;cl&quot;:&quot;client 1&quot;}}</span></p><h2 class="c13" id="h.j82ueh689dml"><span class="c4">d. Connect Acknowledgement</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0 c6">Server responds</span><span class="c6">&nbsp;to a </span><span class="c0 c6">connect</span><span class="c6">&nbsp;packet by sending a </span><span class="c0 c6">connect ack</span><span class="c6">. The connect ack notifies the client that the server has accepted the </span><span>session</span><span class="c6">&nbsp;request or not. The server </span><span>MUST</span><span class="c6">&nbsp;validate the auth token and client id sent by the client and return an appropriate </span><span class="c0 c6">status code</span><span class="c6">&nbsp;along with the </span><span class="c0 c6">timeout seconds</span><span class="c10 c6">&nbsp;(no of seconds the server will wait before closing an idle connection) in the connect ack.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;connAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.e2315c2fcc76ec22338af6d7b9e53e7727ac82a1"></a><a id="t.4"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c33">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Status Code</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">st</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Integer</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Timeout Seconds</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">ts</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Integer</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if Status Code is 1 (OK)</span></p></td></tr></tbody></table><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c10 c6">1. Status code 1 (OK) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;connAck&quot;: {&quot;st&quot;: 1, &quot;ts&quot;: 15}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. Status code 0 (FAILED) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;connAck&quot;: {&quot;st&quot;: 0}}</span></p><h2 class="c13" id="h.hju3ogj54d75"><span>e</span><span class="c4">. Heartbeat Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>Once a session is established, the clients</span><span class="c6">&nbsp;</span><span>MUST</span><span class="c6">&nbsp;send </span><span class="c0 c6">periodical heartbeat</span><span class="c6">&nbsp;within the </span><span class="c0 c6">timeout seconds</span><span class="c6">&nbsp;specified by the server in the </span><span class="c0 c6">connect ack</span><span class="c6">. The he</span><span>artbea</span><span class="c6">t contains </span><span class="c0 c6">no data</span><span class="c6">&nbsp;and just notifies the server that the client is online and active. The server </span><span>shall</span><span class="c6">&nbsp;close a </span><span>session</span><span class="c6">&nbsp;if </span><span>the client</span><span class="c6">&nbsp;does not </span><span>send</span><span class="c6">&nbsp;heartbeat packets for the timeout seconds. </span><span>A client MUST send the heartbeats throughout an active session.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;hb</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Parameters :</span><span class="c10 c6">&nbsp;No parameters</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Sample Packets :</span><span>&nbsp;</span><span class="c25">{&quot;hb&quot;:{}}</span></p><h2 class="c13" id="h.77cdkz6m7ixe"><span>f</span><span class="c4">. Heartbeat Acknowledgement</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0 c6">Server </span><span class="c0">MUST</span><span class="c0 c6">&nbsp;respond</span><span class="c6">&nbsp;to the </span><span class="c0 c6">heartbeats</span><span class="c6">&nbsp;received from the connected clients with the </span><span class="c0 c6">heartbeat ack</span><span class="c6">. The heartbeat ack notifies the client that the server is receiving its heartbeats and is online. </span><span>The server </span><span class="c0">MUST not respond</span><span>&nbsp;to any heartbeat packets if the </span><span class="c0">client has not established the session</span><span>&nbsp;yet by sending the Connection Packet or t</span><span class="c0">he session has been closed</span><span>.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;hbAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Parameters :</span><span>&nbsp;</span><span class="c10 c6">No parameters</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Sample Packets :</span><span>&nbsp;</span><span class="c25">{&quot;hbAck&quot;:{}}</span></p><h2 class="c13" id="h.s2jdhmr3bkev"><span>g</span><span class="c4">. Subscribe Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0 c6">Clients generate</span><span class="c6">&nbsp;subscribe</span><span class="c6">&nbsp;packets and send to the server to </span><span class="c0 c6">subscribe</span><span class="c6">&nbsp;to a particular </span><span class="c0 c6">channel</span><span class="c6">. </span><span class="c6">The subscribe requests </span><span>MUST be</span><span class="c6">&nbsp;</span><span>validated</span><span class="c6">&nbsp;by the server and it sends back a status code </span><span>notifying</span><span class="c10 c6">&nbsp;that the subscription has been successful or not.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">The subscribe packets also contains a </span><span class="c0 c6">flag</span><span class="c6">&nbsp;notifying the </span><span class="c0 c6">persistence</span><span class="c6">&nbsp;of the subscription. </span><span>See </span><span class="c0 c21"><a class="c12" href="#h.8crgxdt3uq6v">section 9.c </a></span><span class="c10 c6">for the details of persistence subscription.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">Subscription to </span><span class="c0 c6">control</span><span class="c6">&nbsp;channels and </span><span class="c0">P2P</span><span class="c6">&nbsp;channels are </span><span class="c0 c6">not allowed</span><span class="c6">&nbsp;(see </span><span class="c0 c6 c21"><a class="c12" href="#h.7lqzk4nh64pz">section </a></span><span class="c0 c21"><a class="c12" href="#h.7lqzk4nh64pz">9.d</a></span><span>&nbsp;for details</span><span class="c10 c6">).</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">Packet type code :</span><span class="c10 c6">&nbsp;sub</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.0fd6ccdae16298aad231654610b6136102b687a6"></a><a id="t.5"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c33">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Channel Name</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cn</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Persistence Flag</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">pr</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Bit (0 or 1)</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">No, default is 0</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span>1. No persistent flag (default) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;sub&quot;:{&quot;cn&quot;:&quot;my channel&quot;}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. Persistent flag on :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;sub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;pr&quot;:1}}</span></p><h2 class="c13" id="h.olfp3xv4uhrl"><span class="c4">h. Subscribe Acknowledgement</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>The subscribe requests are </span><span class="c0">validated</span><span>&nbsp;by the server and it acknowledges with a </span><span class="c0">status code</span><span>&nbsp;and the </span><span class="c0">channel name</span><span class="c10 c6">&nbsp;notifying that the subscription has been successful or not.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;subAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6 c11">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.ea97185c6522bbf8d04fd34d7684f1a39f8bd8e5"></a><a id="t.6"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Channel Name</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cn</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Status Code</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">st</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Int</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span>1. Status code 1 (OK) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;subAck&quot;: {&quot;st&quot;: 1, &quot;cn&quot;: &quot;my channel&quot;}}</span></p><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>2. Status code 0 (FAILED) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;subAck&quot;: {&quot;st&quot;: 0, &quot;cn&quot;: &quot;my channel&quot;}}</span></p><h2 class="c13" id="h.jc7c4nsh5sap"><span class="c4">i. Unsubscribe Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0">Clients generate</span><span>&nbsp;unsubscribe packets and send to the server to </span><span class="c0">unsubscribe</span><span>&nbsp;to a </span><span class="c0">subscribed</span><span>&nbsp;</span><span class="c0">channel</span><span>. The unsubscribe requests </span><span class="c0">may be validated</span><span>&nbsp;by the server, </span><span class="c0">depending on the implementation</span><span>, though it is </span><span class="c0">not mandatory</span><span>. Unsubscribing means that the </span><span class="c0">client won&rsquo;t get any push messages published to that particular channel</span><span class="c10 c6">. If the client sends an unsubscription request to a channel which the client is not subscribed to, the server may or may not send an error code (status code other than OK) depending on the server implementation.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;sub</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.b1cdca803ba326d72f0fd7780959f6391563feb8"></a><a id="t.7"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Channel Name</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cn</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;unsub&quot;:{&quot;cn&quot;:&quot;my channel&quot;}}</span></p><h2 class="c13" id="h.dzw4q9z9s7r9"><span class="c4">j. Unsubscribe Acknowledgement</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>The unsubscribe requests are </span><span class="c0">acknowledged</span><span>&nbsp;by the server with a </span><span class="c0">status code</span><span>&nbsp;and the </span><span class="c0">channel name</span><span>&nbsp;notifying that the unsubscription has been successful or not. The unsubscribe requests </span><span class="c0">may be validated</span><span>&nbsp;by the server, depending on the implementation, though it is </span><span class="c0">not mandatory</span><span class="c10 c6">.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;unsubAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.ea97185c6522bbf8d04fd34d7684f1a39f8bd8e5"></a><a id="t.8"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Channel Name</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cn</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Status Code</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">st</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Int</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span>1. Status code 1 (OK) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;unsubAck&quot;: {&quot;st&quot;: 1, &quot;cn&quot;: &quot;my channel&quot;}}</span></p><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>2. Status code 0 (FAILED) :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;unsubAck&quot;: {&quot;st&quot;: 0, &quot;cn&quot;: &quot;my channel&quot;}}</span></p><h2 class="c13" id="h.ma2f1jaepdzx"><span class="c4">k. Publish Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0">Clients </span><span>send publish packet to the server to </span><span class="c0">publish a message (or data) to a channel</span><span>. The data can be a </span><span class="c0">JSON object or a String</span><span>. A publish packet contains the channel and data, an optional QOS (for details see </span><span class="c0 c21"><a class="c12" href="#h.ug756rndpk1s">section 9.a</a></span><span>), optional packet id (if QOS is set to 0) and an optional retained flag (see </span><span class="c0 c21"><a class="c12" href="#h.ja7lxeorgb6l">section 9.b</a></span><span class="c10 c6">&nbsp;for details). </span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;pub</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.0a94081e0d2753769e0824bbaa35b6f42beaeb90"></a><a id="t.9"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Channel Name</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cn</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c6 c10">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Data</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">dt</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">JSON or String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">QOS</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">q</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Int</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">No, default is 0</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Packet Id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if QOS is 1</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Retained Flag</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">rt</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Bit (0 or 1)</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">No, default is 0</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c10 c6">1. Basic publish packet with string data (QOS 0, Retained flag off) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;}}</span></p><p class="c15"><span class="c10 c6">2. Basic publish packet with JSON data (QOS 0, Retained flag off) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:{&quot;msg&quot;: &quot;my message&quot;}}}</span></p><p class="c2"><span class="c27 c6"></span></p><p class="c15"><span class="c10 c6">3. Publish packet with QOS 1, Retained flag off :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;q&quot;:1,&quot;id&quot;:&quot;4&quot;}}</span></p><p class="c2"><span class="c6 c27"></span></p><p class="c15"><span class="c10 c6">4. Publish packet with QOS 1, Retained flag on :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;q&quot;:1,&quot;id&quot;:&quot;4&quot;,&quot;rt&quot;:1}}</span></p><h2 class="c13" id="h.qw02dn3mow1r"><span class="c4">l. Publish Acknowledgment</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>If the </span><span class="c0">QOS</span><span>&nbsp;of a </span><span class="c0">publish</span><span>&nbsp;packet is set to </span><span class="c0">1</span><span>, the server MUST send a </span><span class="c0">publish acknowledgement </span><span>to the client. The server validates the publish packets and if the QOS is 1, it responds with a </span><span class="c0">status code</span><span>&nbsp;and the </span><span class="c0">packet id</span><span>&nbsp;sent by the client. The </span><span class="c0">server may decline a publish request</span><span>&nbsp;based on the business logic. If the </span><span class="c0">client does not receive the acknowledgement</span><span>&nbsp;of a QOS 1 packet, the client may </span><span class="c0">retry</span><span class="c10 c6">&nbsp;sending the packet using the same packet id.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;pubAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.4a2e68836a247699f88fa31988742911c88248e6"></a><a id="t.10"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Status Code</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">st</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Int</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Packet Id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if QOS is 1</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c10 c6">1. Status code 1 (OK) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pubAck&quot;: {&quot;st&quot;: 1, &quot;id&quot;: &quot;4&quot;}}</span></p><p class="c2"><span class="c27 c6"></span></p><p class="c15"><span class="c10 c6">2. Status code 0 (FAILED) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pubAck&quot;: {&quot;st&quot;: 0, &quot;id&quot;: &quot;4&quot;}}</span></p><h2 class="c13" id="h.buezqc6h7nbg"><span class="c4">m. Push Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c0">When a client sends</span><span>&nbsp;a </span><span class="c0">publish</span><span>&nbsp;packet to the server, the server </span><span class="c0">distributes</span><span>&nbsp;the data to the </span><span class="c0">subscribed clients of the published channel</span><span>&nbsp;using a </span><span class="c0">push</span><span>&nbsp;packet. The push packets </span><span class="c0">look similar</span><span>&nbsp;to the </span><span class="c0">publish</span><span>&nbsp;packets, but it is </span><span class="c0">sent from the server to the clients</span><span>. The </span><span class="c0">QOS</span><span>&nbsp;of the publish packet is </span><span class="c0">replicated</span><span>&nbsp;in the push packet. The</span><span class="c0">&nbsp;packet id</span><span>&nbsp;of the push packets are </span><span class="c0">maintained</span><span>&nbsp;by the server. Push packets contain the </span><span class="c0">source client id</span><span>&nbsp;of the message, and if the </span><span class="c0">message</span><span>&nbsp;is generated </span><span class="c0">by the server</span><span>, then the </span><span class="c0">client id</span><span>&nbsp;field is left </span><span class="c0">blank</span><span>&nbsp;(see </span><span class="c0 c21"><a class="c12" href="#h.6bpomxmd8hqn">section 9.e</a></span><span>&nbsp;for details). The server </span><span class="c0">may decide to store</span><span>&nbsp;a push packet depending on the QOS and retained flag (see </span><span class="c0 c21"><a class="c12" href="#h.ug756rndpk1s">section 9.a</a></span><span>&nbsp;and </span><span class="c0 c21"><a class="c12" href="#h.ja7lxeorgb6l">9.b</a></span><span class="c10 c6">). If the message is a retained message, the retained flag will be sent &lsquo;on&rsquo; or 1. Retained messages MUST not contain any packet id.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;push</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.b682c8e44fb7ec838dba595584fc6e004f7729b2"></a><a id="t.11"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Channel Name</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cn</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Data</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">dt</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">JSON or String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Source Client Id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">cl</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, can be empty</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">QOS</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">q</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Int</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">No, default is 0</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Packet Id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if QOS is 1</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Retained Flag</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">rt</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Bit (0 or 1)</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">No, default is 0</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c10 c6">1. Basic push packet with String data (QOS 0, Retained flag off) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;cl&quot;:&quot;client 1&quot;}}</span></p><p class="c2"><span class="c27 c6"></span></p><p class="c15"><span class="c10 c6">2. Basic push packet with JSON data (QOS 0, Retained flag off) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:{&quot;msg&quot;: &quot;my message&quot;},&quot;cl&quot;:&quot;client 1&quot;}}</span></p><p class="c2"><span class="c27 c6"></span></p><p class="c15"><span class="c10 c6">3. Push packet with QOS 1, Retained flag off :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;cl&quot;:&quot;client 1&quot;,&quot;q&quot;:1,&quot;id&quot;:&quot;400&quot;}}</span></p><p class="c2"><span class="c27 c6"></span></p><p class="c15"><span class="c10 c6">4. Push packet with Retained flag on :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;cl&quot;:&quot;client 1&quot;,&quot;rt&quot;:1}}</span></p><h2 class="c13" id="h.oxdbvk88t65o"><span class="c4">n. Push Acknowledgment</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>If the </span><span class="c0">QOS</span><span>&nbsp;of a </span><span class="c0">push</span><span>&nbsp;packet is set to </span><span class="c0">1</span><span>, the client MUST send a </span><span class="c0">push acknowledgement </span><span>to the server. The push a</span><span class="c0">ck looks similar to the publish ack</span><span>. If the </span><span class="c0">server does not receive a push ack</span><span>, it MUST </span><span class="c0">store the packet</span><span>&nbsp;in some permanent storage and </span><span class="c0">retry sending it </span><span class="c10 c6">when the client reconnects. Push ack for the retain packets are not required.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;pushAck</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c11 c0 c6">Parameters :</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.4a2e68836a247699f88fa31988742911c88248e6"></a><a id="t.12"></a><table class="c17"><tbody><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Parameter</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Key</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c1">Required</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Status Code</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">st</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Int</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes</span></p></td></tr><tr class="c5"><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Packet Id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">id</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">String</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c16"><span class="c10 c6">Yes, if QOS is 1</span></p></td></tr></tbody></table><p class="c2"><span class="c11 c0 c6"></span></p><p class="c15"><span class="c0">Sample Packets :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pushAck&quot;: {&quot;st&quot;: 1, &quot;id&quot;: &quot;400&quot;}}</span></p><h2 class="c13" id="h.71q18h5vmqkr"><span class="c4">o. Disconnection Packet</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>If a client </span><span class="c0">willingly closes a session</span><span>, it MUST send a </span><span class="c0">disconnect packet</span><span>&nbsp;to the server before the disconnection. It </span><span class="c0">notifies</span><span>&nbsp;the server that the client connection is </span><span class="c0">not being closed abruptly</span><span>&nbsp;(due to network problem or some other technical problem). The server may clear the cache and buffer allocated for the client depending on the server implementation. The disconnect packet </span><span class="c0">does not contain any data</span><span>&nbsp;inside its body. Any non-persistent subscription (refer to </span><span class="c0 c21"><a class="c12" href="#h.8crgxdt3uq6v">section 9.c</a></span><span class="c10 c6">) will be removed from the server after the client sends a disconnection packet.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Packet type code :</span><span class="c10 c6">&nbsp;disconn</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Parameters :</span><span class="c10 c6">&nbsp;No parameters</span></p><p class="c15"><span class="c11 c0 c6">Sample Packets :</span></p><p class="c2"><span class="c11 c0 c6"></span></p><p class="c18"><span class="c25">{&quot;disconn&quot;:{}}</span></p><h1 class="c13" id="h.ygslinu4oodu"><span class="c34 c6 c9">8. Status Codes</span></h1><p class="c15"><span class="c10 c6">JMQT status code is a integer indicating the status of a request. The server sends status code with every acknowledgement against a request generated by the client. The JMQT client also sends a status code against the push packets sent by the server. </span></p><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">JMQT status code are listed below -</span></p><p class="c2"><span class="c10 c6"></span></p><a id="t.24c579ef8968dfd4e99b17068e9cbc24f6b8bedc"></a><a id="t.13"></a><table class="c17"><tbody><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">1</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">OK</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">The requested action has been successfully completed by the server</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">0</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">FAILED</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">The server has failed to perform the requested task</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">5</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">SERVER ERROR</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">Notifies that the server has encountered an error</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">6</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">INVALID TOKEN</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">The token passed in &lsquo;Conn&rsquo; packet is invalid</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">7</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">NOT ALLOWED</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">The client is not allowed to perform the specific task</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">8</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">CLIENT OFFLINE</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">Special response code for P2P messages notifying that the destination client is offline.</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">10</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">INVALID PACKET</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">The request packet is malformed</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">11</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">INVALID CHANNEL</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">The channel is invalid. e.g. subscribing or unsubscribing to a control or P2P channel</span></p></td></tr><tr class="c5"><td class="c8" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">9</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c24"><span class="c10 c6">NETWORK ERROR</span></p></td><td class="c37" colspan="1" rowspan="1"><p class="c15"><span class="c10 c6">Client program shall generate this error code if the client is unable to connect the server</span></p></td></tr></tbody></table><h1 class="c13" id="h.nyr83t205lkz"><span class="c34 c6 c9">9. Operational Behaviour</span></h1><h2 class="c13" id="h.ug756rndpk1s"><span>a. Quality of Service</span></h2><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span>JMQT has a concept of </span><span class="c0">QOS</span><span>&nbsp;(Quality of Service). Depending on the QOS, the </span><span class="c0">server</span><span>&nbsp;</span><span class="c0">may or may not store and acknowledge</span><span>&nbsp;to a </span><span class="c0">&lsquo;publish&rsquo;</span><span>&nbsp;packet, and the </span><span class="c0">client</span><span>&nbsp;</span><span class="c0">may or may not acknowledge</span><span>&nbsp;to a </span><span class="c0">&lsquo;push&rsquo;</span><span>&nbsp;packet. The QOS can either be 0 or 1. The &lsquo;q&rsquo; key in a publish packet denotes the QOS. If </span><span class="c0">no QOS is mentioned</span><span>&nbsp;in a packet, i.e. the &lsquo;q&rsquo; key is not set, the server MUST </span><span class="c0">consider the QOS as 0</span><span class="c10 c6">. If QOS is set to 1, the client MUST include a packet id (&lsquo;id&rsquo; key) in the publish packet. </span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Example :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">1. Default QOS (QOS 0) :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. QOS 1 :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;q&quot;:1,&quot;id&quot;:&quot;1&quot;}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>If the </span><span class="c0">QOS</span><span>&nbsp;is set to </span><span class="c0">&lsquo;0&rsquo;</span><span>&nbsp;in a publish packet, the server will </span><span class="c0">distribute</span><span>&nbsp;the message (by sending </span><span class="c0">push</span><span>&nbsp;packets which also have the </span><span class="c0">QOS</span><span>&nbsp;set to </span><span class="c0">&lsquo;0</span><span>&rsquo;) among the </span><span class="c0">connected</span><span>&nbsp;clients which are </span><span class="c0">subscribed</span><span>&nbsp;to the channel and will </span><span class="c0">forget</span><span>&nbsp;the packet. This means, </span><span class="c0">no offline subscriber</span><span>&nbsp;will </span><span class="c0">receive</span><span>&nbsp;the message when they reconnects. The </span><span class="c0">online</span><span>&nbsp;</span><span class="c0">subscribers</span><span>&nbsp;who will receive the &lsquo;push&rsquo; message from the server, </span><span class="c0">do not need to acknowledge</span><span class="c10 c6">&nbsp;if the QOS is set to &lsquo;0&rsquo;.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Example of QOS 0 push packets:</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;cl&quot;:&quot;client id&quot;, &quot;q&quot;:0}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>If the </span><span class="c0">QOS</span><span>&nbsp;is set to </span><span class="c0">&lsquo;1&rsquo;</span><span>&nbsp;in a </span><span class="c0">publish</span><span>&nbsp;packet, the </span><span class="c0">server</span><span>&nbsp;will first </span><span class="c0">store</span><span>&nbsp;the message, then it will </span><span class="c0">distribute</span><span>&nbsp;the message (by sending </span><span class="c0">push</span><span>&nbsp;packets with </span><span class="c0">QOS</span><span>&nbsp;set to </span><span class="c0">&lsquo;1&rsquo;</span><span>) among the </span><span class="c0">connected</span><span>&nbsp;clients which are </span><span class="c0">subscribed</span><span>&nbsp;to the channel. The </span><span class="c0">online</span><span>&nbsp;</span><span class="c0">subscribers</span><span>&nbsp;who will </span><span class="c0">receive</span><span>&nbsp;the &lsquo;push&rsquo; message from the server, </span><span class="c0">MUST acknowledge</span><span>&nbsp;if the </span><span class="c0">QOS</span><span>&nbsp;is set to</span><span class="c0">&nbsp;&lsquo;1</span><span>&rsquo;. If the server </span><span class="c0">does not receive</span><span>&nbsp;the push </span><span class="c0">acknowledgement</span><span>&nbsp;from a client or the client is offline, it will </span><span class="c0">send</span><span>&nbsp;the </span><span class="c0">stored</span><span>&nbsp;message </span><span class="c0">again</span><span>&nbsp;when the </span><span class="c0">client reconnects</span><span>&nbsp;to the server. The QOS 1 packets may be pushed to the client </span><span class="c0">more than once</span><span>&nbsp;to ensure the delivery. The </span><span class="c0">packet id </span><span>of the push packets are </span><span class="c0">generated</span><span>&nbsp;by the </span><span class="c0">server</span><span>&nbsp;and </span><span class="c0">independent</span><span>&nbsp;to the </span><span class="c0">packet id sent by the client</span><span class="c10 c6">&nbsp;in the publish packet.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Example of QOS 1 push packets:</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;: {&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;cl&quot;:&quot;client id&quot;, &quot;id&quot;: &quot;1&quot;, &quot;q&quot;: 1}}</span></p><h2 class="c13" id="h.ja7lxeorgb6l"><span class="c4">b. Retained Packets</span></h2><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>The </span><span class="c0">retained</span><span>&nbsp;messages are used for allowing the new subscriber to receive the </span><span class="c0">most current message of that channel</span><span class="c10 c6">&nbsp;rather than waiting for the next update from a publisher.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>Retained</span><span class="c6">&nbsp;messages are different from the QOS. If </span><span>a</span><span class="c6">&nbsp;</span><span class="c0 c6">channel does not have any subscribed clients</span><span class="c6">, </span><span class="c0 c6">QOS 1</span><span class="c6">&nbsp;messages </span><span>are</span><span class="c6">&nbsp;</span><span class="c0 c6">discarded</span><span class="c6">&nbsp;by the server, whereas the </span><span class="c0 c6">retained messages</span><span class="c6">&nbsp;</span><span>are</span><span class="c6">&nbsp;still </span><span class="c0 c6">stored</span><span class="c6">&nbsp;for the </span><span class="c0 c6">future subscribers</span><span class="c6">. There can be </span><span class="c0 c6">only one</span><span class="c6">&nbsp;(the latest) </span><span class="c0 c6">retained</span><span class="c6">&nbsp;message stored in the server for a </span><span class="c0 c6">particular channel</span><span class="c6">&nbsp;at any point of time. Server </span><span>MUST</span><span class="c6">&nbsp;send the retained messages to the client in two situations : 1. When the client connects to the server and it has persistent subscriptions to a channel (see </span><span class="c0 c6 c21"><a class="c12" href="#h.8crgxdt3uq6v">section 9.c</a></span><span class="c6">). 2. When the client subscribes to a channel. The </span><span>push packet</span><span class="c6">s </span><span>MUST</span><span class="c6">&nbsp;have the retain flag on. </span><span class="c0 c6">Retained push packets do not have </span><span class="c0">a</span><span class="c0 c6">&nbsp;packet id and retai</span><span class="c0">ned flag is set to 1</span><span>&nbsp;to inform the client that the packet is a retained packet. The</span><span class="c6">&nbsp;clients </span><span class="c0 c6">do not</span><span class="c6">&nbsp;need to send </span><span class="c0 c6">push ack</span><span class="c6">&nbsp;for any retained packets. </span><span>Retained packets are not available for the Control and P2P channels.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>A publish packet may have the </span><span class="c0">retained flag</span><span>&nbsp;(&lsquo;rt&rsquo; key) and </span><span class="c0">QOS</span><span>&nbsp;</span><span class="c0">both</span><span>&nbsp;set to </span><span class="c0">1</span><span>, </span><span class="c0">either</span><span>&nbsp;of them set to </span><span class="c0">1</span><span>, or </span><span class="c0">both</span><span>&nbsp;set to </span><span class="c0">0</span><span>. If the </span><span class="c0">retained flag is not mentioned</span><span>&nbsp;in a packet, the server MUST </span><span class="c0">consider</span><span>&nbsp;the retained flag as </span><span class="c0">0</span><span class="c0">&nbsp;or off</span><span class="c10 c6">.</span></p><p class="c2"><span class="c6 c19 c28"></span></p><p class="c15"><span class="c10 c6">Example :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">1. Publish packets with retain flag on :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;rt&quot;:1}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">2. </span><span>P</span><span class="c6">ush packets </span><span>with</span><span class="c10 c6">&nbsp;retained messages :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;: {&quot;cn&quot;:&quot;my channel&quot;,&quot;dt&quot;:&quot;my message&quot;,&quot;cl&quot;:&quot;client id&quot;, &quot;rt&quot;: &quot;1&quot;}}</span></p><h2 class="c13" id="h.8crgxdt3uq6v"><span class="c4">c. Persistent Subscription</span></h2><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Persistent subscriptions are used to store the subscription in the server even after a client session is closed.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>The subscribe packets contains a </span><span class="c0">flag</span><span>&nbsp;notifying the </span><span class="c0">persistence</span><span>&nbsp;of the subscription. If the persistent </span><span class="c0">flag is on</span><span>&nbsp;(i.e. 1), the server MUST </span><span class="c0">store the subscription</span><span>&nbsp;even if after the </span><span class="c0">client session is closed</span><span>. If the </span><span class="c0">flag is off</span><span>&nbsp;(i.e. 0), the server </span><span class="c0">will remove the subscription</span><span>&nbsp;mapping when the client </span><span class="c0">disconnects</span><span class="c10 c6">. </span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>The server </span><span class="c0">MUST store all the QOS 1</span><span>&nbsp;packets of the persistent </span><span class="c0">channels</span><span>&nbsp;even if the </span><span class="c0">client is offline</span><span>. The server MUST </span><span class="c0">resend</span><span>&nbsp;the </span><span class="c0">stored messages</span><span>&nbsp;once the client reconnects and establishes a new session. Clients </span><span class="c0">do not</span><span>&nbsp;need to </span><span class="c0">subscribe</span><span>&nbsp;to channel </span><span class="c0">again</span><span>&nbsp;if the subscription is </span><span class="c0">persistent</span><span>&nbsp;until the client unsubscribes to the channel. Non-persistent subscriptions are automatically unsubscribed when the client disconnects. To </span><span class="c0">change the persistence of a subscription</span><span>, the client MUST </span><span class="c0">unsubscribe</span><span>&nbsp;to the channel, and </span><span class="c0">subscribe</span><span>&nbsp;it </span><span class="c0">again</span><span class="c10 c6">&nbsp;with the desired persistence flag.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Example :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">1. Subscription with persistent flag on :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;sub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;pr&quot;:1}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. Subscription with persistent flag off / default :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;sub&quot;:{&quot;cn&quot;:&quot;my channel&quot;,&quot;pr&quot;:0}}</span></p><h2 class="c13" id="h.7lqzk4nh64pz"><span>d</span><span class="c4">. P2P and Control Packets</span></h2><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">There are two </span><span class="c0 c6">special types of channels</span><span class="c6">&nbsp;available in JMQT, </span><span class="c0 c6">control</span><span class="c6">&nbsp;channels and </span><span class="c0 c6">P2P</span><span class="c10 c6">&nbsp;channels.</span></p><p class="c15"><span class="c10 c6">&nbsp;</span></p><p class="c15"><span>Control channels are similar to the HTTP API calls. </span><span class="c0 c6">Control</span><span class="c6">&nbsp;channels (</span><span class="c0 c6">starts with $</span><span class="c6">) are used to </span><span class="c0 c6">retrieve some information from the server</span><span class="c6">&nbsp;itself. Implementation of control channels is optional and server dependent. The client may publish a packet with or without data to a control channel which the server </span><span>MUST</span><span class="c6">&nbsp;process and respond to the client. Any </span><span>packet published to a control channel MUST contain a packet id.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Example of control packets:</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Step 1. Client publishes a message to control channel (to get a list of the subscribed channels) -</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;:&quot;$mySubscriptions&quot;,&quot;dt&quot;:{},&quot;id&quot;:&quot;2&quot;}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Step 2. Server responds back with publish ack with required data (list of the subscribed channels) -</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pubAck&quot;: {&quot;st&quot;: 1, &quot;id&quot;: &quot;2&quot;, &quot;dt&quot;: {&quot;channels&quot;: [&quot;my channel&quot;]}}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0 c6">P2P</span><span class="c6">&nbsp;channels (</span><span class="c0 c6">starts with #</span><span class="c6">) are used to </span><span class="c0 c6">send</span><span class="c6">&nbsp;messages </span><span class="c0 c6">directly</span><span class="c6">&nbsp;to one client from another client. In order to send a P2P message, the sender </span><span>MUST</span><span class="c6">&nbsp;know the </span><span class="c0 c6">P2P address</span><span class="c6">&nbsp;of the receiver. P2P messaging is also optional, but </span><span>it&rsquo;s recommended</span><span class="c6">&nbsp;in the applications where the clients always need to talk to each other directly (e.g. chat applications) without the need of broadcasting a message to multiple clients. The </span><span>behaviour of P2P channels are just like the normal channels (i.e. it supports QOS) except the P2P channels does not support retained packets.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Example of P2P packets:</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">1. P2P publish packet with QOS 1 -</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;pub&quot;:{&quot;cn&quot;: &quot;#my client 1&quot;, &quot;dt&quot;: &quot;my p2p message&quot;, &quot;id&quot;: &quot;5&quot;, &quot;q&quot;: 1}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">2. P2P push packets -</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;:{&quot;cn&quot;:&quot;#my client 1&quot;,&quot;dt&quot;:&quot;my p2p message&quot;,&quot;cl&quot;:&quot;my client 2&quot;,&quot;id&quot;: &quot;401&quot;,&quot;q&quot;: 1}}</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Clients are never allowed to subscribe</span><span>&nbsp;to a control channel or a P2P channel. Subscriptions to the P2P channels are controlled by the server (see </span><span class="c0 c21"><a class="c12" href="#h.6bpomxmd8hqn">section 9.e </a></span><span class="c10 c6">for details).</span></p><h2 class="c13" id="h.6bpomxmd8hqn"><span>e</span><span class="c4">. Server side Sub, Unsub and Push</span></h2><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>JMQT protocol includes the </span><span class="c0">possibility to perform subscription and unsubscription</span><span>&nbsp;</span><span class="c0">initiated by the server</span><span class="c10 c6">. </span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span>When a client establishes a </span><span class="c0">new session</span><span>, the server </span><span class="c0">may make the client subscribe and/or unsubscribe</span><span>&nbsp;to certain channels without the subscription and/or unsubscription request generated by the client. In case of </span><span class="c0">P2P channels</span><span>, the </span><span class="c0">subscription request should not be generated by the client</span><span>, instead the server MUST </span><span class="c0">perform the subscription to the P2P channels on behalf of the client</span><span class="c10 c6">&nbsp;when the client establishes a session. In certain applications, it is also possible that the server will completely decline any subscription or unsubscription request from the clients, and subscription or unsubscription operations will be performed by the server itself.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c0">Server can also push messages to all the available channels without having a publish packet received from a client</span><span class="c10 c6">. This ensures that the server may push required information (such as software update notification, billing notification etc.) directly to the clients anytime the server wants. The push packets generated by the server does not have any value assigned to the source client id (the &lsquo;cl&rsquo; key in push packets), instead the value is left empty (blank string). The QOS principle is similar to that of the normal push packets. Follow is an example of a server side QOS 1 push packet :</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c18"><span class="c25">{&quot;push&quot;: {&quot;cn&quot;: &quot;server channel&quot;, &quot;dt&quot;: &quot;You have an update&quot;, &quot;cl&quot;: &quot;&quot;, &quot;id&quot;: &quot;402&quot;, &quot;q&quot;: 1}}</span></p><h2 class="c13" id="h.mab1zj286xne"><span class="c4">f. Disconnection behaviour</span></h2><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c19">The client can disconnect the server (or end a session) in </span><span class="c0 c19">three</span><span class="c19">&nbsp;ways - </span><span class="c0 c19">1. The client can just close the socket or websocket connection</span><span class="c19">, </span><span class="c0 c19">2. The client may send a disconnection packet to the server</span><span class="c19">, </span><span class="c0 c19">3. Both 1 and 2</span><span class="c19">. The </span><span class="c0 c19">recommended</span><span class="c19">&nbsp;way of disconnection is</span><span class="c0 c19">&nbsp;way no. 3</span><span class="c28 c6 c19">, as it ensures the server that the client is initiating the disconnection willingly and the server can clear the cache (if any) assigned to that particular session. Disconnecting the socket or websocket is also important because an unused socket or websocket connection may lead to network error in the client system. </span></p><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c19">When a session is closed, the server MUST remove all non-persistent subscriptions from the disconnected client along with the QOS 1 push packets mapped for that particular client. The client SHOULD stop sending the heartbeat packets once the session is closed.</span></p><h1 class="c13" id="h.kifcx4unbfeg"><span class="c34 c6 c9">10. Authentication and security</span></h1><p class="c2"><span class="c28 c6 c19"></span></p><p class="c15"><span class="c6">In order to </span><span class="c0 c6">connect</span><span class="c6">&nbsp;to the server, a client </span><span>MUST</span><span class="c6">&nbsp;send a combination of </span><span class="c0 c6">client id</span><span class="c6">&nbsp;and </span><span class="c0 c6">authentication token</span><span class="c6">&nbsp;to the server. This </span><span class="c0 c6">authentication token</span><span class="c6">&nbsp;and </span><span class="c0 c6">client id</span><span class="c6">&nbsp;can be </span><span class="c0 c6">pre-configured</span><span class="c6">&nbsp;in the client, or the client can retrieve those credentials from the server by sending </span><span>the</span><span class="c6">&nbsp;Auth </span><span>packet</span><span class="c6">, which </span><span>will</span><span class="c10 c6">&nbsp;contain the authentication information like user id and password.</span></p><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c6">JMQT </span><span class="c0 c6">does not define</span><span class="c6">&nbsp;any </span><span class="c0 c6">built-in encryption</span><span class="c6">&nbsp;protocol. However, as it uses TCP connection (</span><span class="c0 c6">Socket</span><span class="c6">&nbsp;and </span><span class="c0 c6">Web</span><span class="c0">S</span><span class="c0 c6">ocket</span><span class="c6">) for communications, </span><span class="c0 c6">TLS</span><span class="c6">&nbsp;(</span><span class="c0 c6">Transport Layer Security</span><span class="c6">) can easily be implemented on top of </span><span class="c0 c6">socket</span><span class="c6">&nbsp;and </span><span class="c0">WebSocket</span><span class="c10 c6">&nbsp;to secure the incoming and outgoing messages.</span></p><p class="c2"><span class="c10 c6"></span></p><h1 class="c13 c47" id="h.tquqrwbagwu3"><span class="c34 c6 c9"></span></h1><h1 class="c13" id="h.ste6oqketqd2"><span class="c34 c6 c9">11. Default TCP Ports</span></h1><p class="c2"><span class="c10 c6"></span></p><p class="c15"><span class="c10 c6">Below is the list of the default TCP port numbers to be used by the JMQT applications :</span></p><p class="c2"><span class="c10 c6"></span></p><ul class="c26 lst-kix_ks098ttg0iz5-0 start"><li class="c15 c22"><span class="c10 c6">8010 : Plain Socket</span></li><li class="c15 c22"><span class="c10 c6">8011 : Plain WebSocket</span></li><li class="c15 c22"><span class="c10 c6">8012 : SSL Socket</span></li><li class="c15 c22"><span class="c10 c6">8013 : SSL WebSocket</span></li></ul></body></html>